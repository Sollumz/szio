import pytest
import numpy as np
from numpy.testing import assert_array_equal
from szio.gta5 import shattermaps


@pytest.mark.parametrize("cols,rows,compressed_shattermap", [
    (
        # ############040A0E11121314141515151515151515151515151514141413110F0C0701000000000000000000000000000001070C0F11131414141515151515151515151515151514141312110E0A04############
        # ######0E22313D454B4F525355555656565656565656565656565656555453504D4841392E2114070000000000000714212E3941484D505354555656565656565656565656565656555553524F4B453D31220E######
        # ####19374F62727D868C9093959696979797979797979797979797969594928E8982796D5F4F3E2D1E140E0E141E2D3E4F5F6D7982898E9294959697979797979797979797979796969593908C867D72624F3719####
        # ##10385B7890A3B2BEC6CCD1D4D6D7D7D8D8D8D8D8D8D8D8D8D8D7D6D5D3CFCAC3BAAE9E8C78634F3D302929303D4F63788C9EAEBAC3CACFD3D5D6D7D8D8D8D8D8D8D8D8D8D8D7D7D6D4D1CCC6BEB2A390785B3810##
        # ##2652799BB8D0E3F3FE--------------------------------------------FBEEDECBB59D836B57473F3F47576B839DB5CBDEEEFBFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEF3E3D0B89B795226##
        # 02376793BADCF9--------------------------------------------------------F4D9BD9F846D5B52525B6D849FBDD9F4FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF9DCBA93673702
        # 0C4478A8D4FA------------------------------------------------------------F9D9B89A806D63636D809AB8D9F9FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFAD4A878440C
        # 134E85B9E9----------------------------------------------------------------F1CEAD917D73737D91ADCEF1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE9B9854E13
        # 19558FC6F9------------------------------------------------------------------E1BEA28D82828DA2BEE1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF9C68F5519
        # 1C5A96D0--------------------------------------------------------------------F2CEB19C91919CB1CEF2FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFD0965A1C
        # 1E5D9BD7----------------------------------------------------------------------DCBFAA9F9FAABFDCFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFD79B5D1E
        # 20609EDC----------------------------------------------------------------------E8CAB6ABABB6CAE8FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFDC9E6020
        # 2161A0DF------------------------------------------------------------------------D3BEB3B3BED3F0FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFDFA06121
        # 2162A2E0------------------------------------------------------------------------D7C2B8B8C2D7F5FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE0A26221
        # 2262A2E0------------------------------------------------------------------------D7C2B7B7C2D7F4FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE0A26222
        # 2262A1DF------------------------------------------------------------------------D2BDB2B2BDD2F0FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFDFA16222
        # 21619FDD----------------------------------------------------------------------E7C9B4A9A9B4C9E7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFDD9F6121
        # 205F9CD8----------------------------------------------------------------------DBBDA89D9DA8BDDBFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFD89C5F20
        # 1E5B98D1--------------------------------------------------------------------F2CDAF9A8F8F9AAFCDF2FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFD1985B1E
        # 1A5691C8FC------------------------------------------------------------------E1BEA18C81818CA1BEE1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFCC891561A
        # 154F87BBEC----------------------------------------------------------------F4CFAD917D72727D91ADCFF4FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFECBB874F15
        # 0D4579AAD7FF--------------------------------------------------------------DCBB9B816E64646E819BBBDCFEFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFD7AA79450D
        # 02376895BDE1FF--------------------------------------------------------FBDFC2A3876F5E54545E6F87A3C2DFFBFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE1BD95683702
        # ##25527B9FBDD7ECFC------------------------------------------------F8E7D3BCA389705B4B43434B5B7089A3BCD3E7F8FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFCECD7BD9F7B5225##
        # ##0E375B7B95AABBC7D1D8DDE0E2E3E4E5E5E5E5E5E5E5E5E5E5E4E3E2DFDBD6CFC5B8A895806A5543352E2E3543556A8095A8B8C5CFD6DBDFE2E3E4E5E5E5E5E5E5E5E5E5E5E4E3E2E0DDD8D1C7BBAA957B5B370E##
        # ####17375267798690979C9FA1A3A3A4A4A4A4A4A4A4A4A4A4A4A4A3A2A19E9A958E847869584635261B15151B263546586978848E959A9EA1A2A3A4A4A4A4A4A4A4A4A4A4A4A4A3A3A19F9C9790867967523717####
        # ######0D2436434E555A5E606162636363636363636363636363636362615F5D59544D44392C1E10040000000004101E2C39444D54595D5F616263636363636363636363636363636261605E5A554E4336240D######
        # ##########000B13181C1E20212122222222222222222222222222222121201E1C18130D05000000000000000000000000050D13181C1E20212122222222222222222222222222222121201E1C18130B00##########
        86, 28,
        b"\x00\x00\x4D\x00\xA0\x00\xF5\x00\x4C\x01\x8E\x01\xCC\x01\x08\x02\x42\x02\x7B\x02\xB3\x02\xEA\x02\x21\x03\x57\x03\x8D\x03\xC3\x03\xF9\x03\x30\x04\x67\x04\x9F\x04\xD8\x04\x12\x05\x4D\x05\x8B\x05\xCB\x05\x22\x06\x77\x06\xCA\x06\x06\x4F\x04\x0A\x0E\x11\x12\x13\x14\x14\x15\x15\x15\x15\x15\x15\x15\x15\x15\x15\x15\x15\x15\x14\x14\x14\x13\x11\x0F\x0C\x07\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x07\x0C\x0F\x11\x13\x14\x14\x14\x15\x15\x15\x15\x15\x15\x15\x15\x15\x15\x15\x15\x15\x14\x14\x13\x12\x11\x0E\x0A\x04\xFF\x03\x52\x0E\x22\x31\x3D\x45\x4B\x4F\x52\x53\x55\x55\x56\x56\x56\x56\x56\x56\x56\x56\x56\x56\x56\x56\x56\x56\x55\x54\x53\x50\x4D\x48\x41\x39\x2E\x21\x14\x07\x00\x00\x00\x00\x00\x00\x07\x14\x21\x2E\x39\x41\x48\x4D\x50\x53\x54\x55\x56\x56\x56\x56\x56\x56\x56\x56\x56\x56\x56\x56\x56\x56\x55\x55\x53\x52\x4F\x4B\x45\x3D\x31\x22\x0E\xFF\x02\x53\x19\x37\x4F\x62\x72\x7D\x86\x8C\x90\x93\x95\x96\x96\x97\x97\x97\x97\x97\x97\x97\x97\x97\x97\x97\x97\x96\x95\x94\x92\x8E\x89\x82\x79\x6D\x5F\x4F\x3E\x2D\x1E\x14\x0E\x0E\x14\x1E\x2D\x3E\x4F\x5F\x6D\x79\x82\x89\x8E\x92\x94\x95\x96\x97\x97\x97\x97\x97\x97\x97\x97\x97\x97\x97\x97\x96\x96\x95\x93\x90\x8C\x86\x7D\x72\x62\x4F\x37\x19\xFF\x01\x54\x10\x38\x5B\x78\x90\xA3\xB2\xBE\xC6\xCC\xD1\xD4\xD6\xD7\xD7\xD8\xD8\xD8\xD8\xD8\xD8\xD8\xD8\xD8\xD8\xD7\xD6\xD5\xD3\xCF\xCA\xC3\xBA\xAE\x9E\x8C\x78\x63\x4F\x3D\x30\x29\x29\x30\x3D\x4F\x63\x78\x8C\x9E\xAE\xBA\xC3\xCA\xCF\xD3\xD5\xD6\xD7\xD8\xD8\xD8\xD8\xD8\xD8\xD8\xD8\xD8\xD8\xD7\xD7\xD6\xD4\xD1\xCC\xC6\xBE\xB2\xA3\x90\x78\x5B\x38\x10\xFF\x01\x09\x26\x52\x79\x9B\xB8\xD0\xE3\xF3\xFE\x20\x54\xFB\xEE\xDE\xCB\xB5\x9D\x83\x6B\x57\x47\x3F\x3F\x47\x57\x6B\x83\x9D\xB5\xCB\xDE\xEE\xFB\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFE\xF3\xE3\xD0\xB8\x9B\x79\x52\x26\x00\x06\x02\x37\x67\x93\xBA\xDC\xF9\x23\x55\xF4\xD9\xBD\x9F\x84\x6D\x5B\x52\x52\x5B\x6D\x84\x9F\xBD\xD9\xF4\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xF9\xDC\xBA\x93\x67\x37\x02\x00\x05\x0C\x44\x78\xA8\xD4\xFA\x24\x55\xF9\xD9\xB8\x9A\x80\x6D\x63\x63\x6D\x80\x9A\xB8\xD9\xF9\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFA\xD4\xA8\x78\x44\x0C\x00\x04\x13\x4E\x85\xB9\xE9\x25\x55\xF1\xCE\xAD\x91\x7D\x73\x73\x7D\x91\xAD\xCE\xF1\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xE9\xB9\x85\x4E\x13\x00\x04\x19\x55\x8F\xC6\xF9\x26\x55\xE1\xBE\xA2\x8D\x82\x82\x8D\xA2\xBE\xE1\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xF9\xC6\x8F\x55\x19\x00\x03\x1C\x5A\x96\xD0\x26\x55\xF2\xCE\xB1\x9C\x91\x91\x9C\xB1\xCE\xF2\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xD0\x96\x5A\x1C\x00\x03\x1E\x5D\x9B\xD7\x27\x55\xDC\xBF\xAA\x9F\x9F\xAA\xBF\xDC\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xD7\x9B\x5D\x1E\x00\x03\x20\x60\x9E\xDC\x27\x55\xE8\xCA\xB6\xAB\xAB\xB6\xCA\xE8\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xDC\x9E\x60\x20\x00\x03\x21\x61\xA0\xDF\x28\x55\xD3\xBE\xB3\xB3\xBE\xD3\xF0\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xDF\xA0\x61\x21\x00\x03\x21\x62\xA2\xE0\x28\x55\xD7\xC2\xB8\xB8\xC2\xD7\xF5\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xE0\xA2\x62\x21\x00\x03\x22\x62\xA2\xE0\x28\x55\xD7\xC2\xB7\xB7\xC2\xD7\xF4\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xE0\xA2\x62\x22\x00\x03\x22\x62\xA1\xDF\x28\x55\xD2\xBD\xB2\xB2\xBD\xD2\xF0\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xDF\xA1\x62\x22\x00\x03\x21\x61\x9F\xDD\x27\x55\xE7\xC9\xB4\xA9\xA9\xB4\xC9\xE7\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xDD\x9F\x61\x21\x00\x03\x20\x5F\x9C\xD8\x27\x55\xDB\xBD\xA8\x9D\x9D\xA8\xBD\xDB\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xD8\x9C\x5F\x20\x00\x03\x1E\x5B\x98\xD1\x26\x55\xF2\xCD\xAF\x9A\x8F\x8F\x9A\xAF\xCD\xF2\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xD1\x98\x5B\x1E\x00\x04\x1A\x56\x91\xC8\xFC\x26\x55\xE1\xBE\xA1\x8C\x81\x81\x8C\xA1\xBE\xE1\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFC\xC8\x91\x56\x1A\x00\x04\x15\x4F\x87\xBB\xEC\x25\x55\xF4\xCF\xAD\x91\x7D\x72\x72\x7D\x91\xAD\xCF\xF4\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xEC\xBB\x87\x4F\x15\x00\x05\x0D\x45\x79\xAA\xD7\xFF\x25\x55\xDC\xBB\x9B\x81\x6E\x64\x64\x6E\x81\x9B\xBB\xDC\xFE\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xD7\xAA\x79\x45\x0D\x00\x06\x02\x37\x68\x95\xBD\xE1\xFF\x23\x55\xFB\xDF\xC2\xA3\x87\x6F\x5E\x54\x54\x5E\x6F\x87\xA3\xC2\xDF\xFB\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xE1\xBD\x95\x68\x37\x02\x01\x08\x25\x52\x7B\x9F\xBD\xD7\xEC\xFC\x21\x54\xF8\xE7\xD3\xBC\xA3\x89\x70\x5B\x4B\x43\x43\x4B\x5B\x70\x89\xA3\xBC\xD3\xE7\xF8\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFF\xFC\xEC\xD7\xBD\x9F\x7B\x52\x25\x01\x54\x0E\x37\x5B\x7B\x95\xAA\xBB\xC7\xD1\xD8\xDD\xE0\xE2\xE3\xE4\xE5\xE5\xE5\xE5\xE5\xE5\xE5\xE5\xE5\xE5\xE4\xE3\xE2\xDF\xDB\xD6\xCF\xC5\xB8\xA8\x95\x80\x6A\x55\x43\x35\x2E\x2E\x35\x43\x55\x6A\x80\x95\xA8\xB8\xC5\xCF\xD6\xDB\xDF\xE2\xE3\xE4\xE5\xE5\xE5\xE5\xE5\xE5\xE5\xE5\xE5\xE5\xE4\xE3\xE2\xE0\xDD\xD8\xD1\xC7\xBB\xAA\x95\x7B\x5B\x37\x0E\xFF\x02\x53\x17\x37\x52\x67\x79\x86\x90\x97\x9C\x9F\xA1\xA3\xA3\xA4\xA4\xA4\xA4\xA4\xA4\xA4\xA4\xA4\xA4\xA4\xA4\xA3\xA2\xA1\x9E\x9A\x95\x8E\x84\x78\x69\x58\x46\x35\x26\x1B\x15\x15\x1B\x26\x35\x46\x58\x69\x78\x84\x8E\x95\x9A\x9E\xA1\xA2\xA3\xA4\xA4\xA4\xA4\xA4\xA4\xA4\xA4\xA4\xA4\xA4\xA4\xA3\xA3\xA1\x9F\x9C\x97\x90\x86\x79\x67\x52\x37\x17\xFF\x03\x52\x0D\x24\x36\x43\x4E\x55\x5A\x5E\x60\x61\x62\x63\x63\x63\x63\x63\x63\x63\x63\x63\x63\x63\x63\x63\x63\x62\x61\x5F\x5D\x59\x54\x4D\x44\x39\x2C\x1E\x10\x04\x00\x00\x00\x00\x04\x10\x1E\x2C\x39\x44\x4D\x54\x59\x5D\x5F\x61\x62\x63\x63\x63\x63\x63\x63\x63\x63\x63\x63\x63\x63\x63\x63\x62\x61\x60\x5E\x5A\x55\x4E\x43\x36\x24\x0D\xFF\x05\x50\x00\x0B\x13\x18\x1C\x1E\x20\x21\x21\x22\x22\x22\x22\x22\x22\x22\x22\x22\x22\x22\x22\x22\x22\x21\x21\x20\x1E\x1C\x18\x13\x0D\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x05\x0D\x13\x18\x1C\x1E\x20\x21\x21\x22\x22\x22\x22\x22\x22\x22\x22\x22\x22\x22\x22\x22\x22\x21\x21\x20\x1E\x1C\x18\x13\x0B\x00\xFF"
    ),
    (
        22, 9,
        b"\x00\x00\x17\x00\x30\x00\x49\x00\x62\x00\x73\x00\x88\x00\xA1\x00\xBA\x00\x01\x14\x00\x21\x3B\x4E\x5D\x68\x6F\x74\x77\x79\x7A\x7A\x79\x76\x70\x68\x5B\x48\x2F\x0E\xFF\x00\x15\x01\x2D\x51\x6E\x84\x94\xA0\xA8\xAE\xB1\xB4\xB5\xB4\xB3\xAF\xA8\x9E\x8E\x79\x5D\x39\x0D\xFF\x00\x15\x20\x4F\x76\x95\xAD\xBF\xCC\xD5\xDB\xDF\xE1\xE2\xE1\xDF\xDB\xD3\xC7\xB6\x9F\x80\x59\x2A\xFF\x00\x15\x35\x65\x8E\xAF\xC8\xDB\xE9\xF2\xF8\xFC\xFE\xFF\xFE\xFC\xF7\xEF\xE2\xD0\xB6\x96\x6D\x3C\xFF\x00\x06\x3D\x6E\x98\xB9\xD3\xE7\xF4\x10\x15\xEC\xD9\xBF\x9E\x74\x42\x00\x08\x39\x6A\x93\xB4\xCE\xE1\xEE\xF7\xFD\x0E\x15\xFA\xF2\xE5\xD2\xB9\x98\x6E\x3D\x00\x15\x2A\x59\x80\xA0\xB8\xCA\xD7\xDF\xE4\xE8\xE9\xEA\xE9\xE6\xE1\xD9\xCD\xBB\xA3\x83\x5C\x2C\xFF\x00\x15\x0F\x3B\x60\x7D\x94\xA4\xAF\xB7\xBB\xBE\xC0\xC0\xBF\xBD\xB8\xB1\xA6\x96\x7F\x62\x3D\x10\xFF\x01\x14\x12\x34\x4E\x62\x70\x7A\x81\x85\x87\x88\x88\x87\x85\x82\x7B\x72\x64\x50\x35\x13\xFF"
    ),
    (
        # E9E2DFDEE1E4E7EBEEF1F4F8FBFF--------------------------------------------------------------------FF
        # B9B1ADACAFB2B6B9BCC0C3C6CACDD1D4D7DBDEE2E5E9ECEFF3F6FAFD----------------------------------------FF
        # 877D78777A7E8185888C8F93979A9EA1A5A9ACB0B4B7BABEC1C5C8CBCFD2D5D9DCDFE2E5E9ECEFF2F5F8FC----------FF
        # 544A444346494D5054575B5E62666A6D7174787C7F83868A8E9195989C9FA3A6AAADB0B4B7BABEC1C4C7CACED8E8FB--FF
        # 2217100F1215181C1F23262A2E3235393C4044474B4E5255595D6064676B6E7275787C7F83868A8D9094979DA8BACDE0F3
        # ############################0205090C1013161A1D2125292C2F33373A3E4144474B4E5255585C5F636A788B9EB2C5
        # ########################################################0003070A0D1013161A1D2124272B2F38475B6F8397
        49, 7,
        b"\x00\x00\x13\x00\x34\x00\x64\x00\x98\x00\xCC\x00\xF2\x00\x00\x0D\xE9\xE2\xDF\xDE\xE1\xE4\xE7\xEB\xEE\xF1\xF4\xF8\xFB\xFF\x30\x30\xFF\x00\x1B\xB9\xB1\xAD\xAC\xAF\xB2\xB6\xB9\xBC\xC0\xC3\xC6\xCA\xCD\xD1\xD4\xD7\xDB\xDE\xE2\xE5\xE9\xEC\xEF\xF3\xF6\xFA\xFD\x30\x30\xFF\x00\x2A\x87\x7D\x78\x77\x7A\x7E\x81\x85\x88\x8C\x8F\x93\x97\x9A\x9E\xA1\xA5\xA9\xAC\xB0\xB4\xB7\xBA\xBE\xC1\xC5\xC8\xCB\xCF\xD2\xD5\xD9\xDC\xDF\xE2\xE5\xE9\xEC\xEF\xF2\xF5\xF8\xFC\x30\x30\xFF\x00\x2E\x54\x4A\x44\x43\x46\x49\x4D\x50\x54\x57\x5B\x5E\x62\x66\x6A\x6D\x71\x74\x78\x7C\x7F\x83\x86\x8A\x8E\x91\x95\x98\x9C\x9F\xA3\xA6\xAA\xAD\xB0\xB4\xB7\xBA\xBE\xC1\xC4\xC7\xCA\xCE\xD8\xE8\xFB\x30\x30\xFF\x00\x30\x22\x17\x10\x0F\x12\x15\x18\x1C\x1F\x23\x26\x2A\x2E\x32\x35\x39\x3C\x40\x44\x47\x4B\x4E\x52\x55\x59\x5D\x60\x64\x67\x6B\x6E\x72\x75\x78\x7C\x7F\x83\x86\x8A\x8D\x90\x94\x97\x9D\xA8\xBA\xCD\xE0\xF3\xFF\x0E\x30\x02\x05\x09\x0C\x10\x13\x16\x1A\x1D\x21\x25\x29\x2C\x2F\x33\x37\x3A\x3E\x41\x44\x47\x4B\x4E\x52\x55\x58\x5C\x5F\x63\x6A\x78\x8B\x9E\xB2\xC5\xFF\x1C\x30\x00\x03\x07\x0A\x0D\x10\x13\x16\x1A\x1D\x21\x24\x27\x2B\x2F\x38\x47\x5B\x6F\x83\x97\xFF"
    ),
    (
        # FA------------------------------------FA
        # D5EF--------------------------------EFD5
        # B1CAE4FF------------------------FFE4CAB1
        # 8BA6C1DDFB--------------------FBDDC1A68B
        # 65819EBDE0--------------------E0BD9E8165
        # 405E7FA4CBF4----------------F4CBA47F5E40
        # 20426993BFEA----------------EABF93694220
        # 09305C89B6E2----------------E2B6895C3009
        # ##255380ADD9----------------D9AD805325##
        # ##1C4976A2CDF8------------F8CDA276491C##
        # ##113D6995C0EA------------EAC095693D11##
        # ####2F5B86B0D6F5--------F5D6B0865B2F####
        # ####204A749BBBD2E0E6E6E0D2BB9B744A20####
        # ####0E365C7E99AAB5BABAB5AA997E5C360E####
        # ######1D3F5B707F888D8D887F705B3F1D######
        # ######001D3445525A5F5F5A5245341D00######
        # ##########0B1A252C30302C251A0B##########
        20, 17,
        b"\x00\x00\x06\x00\x0E\x00\x1A\x00\x28\x00\x36\x00\x46\x00\x56\x00\x66\x00\x74\x00\x84\x00\x94\x00\xA4\x00\xB7\x00\xCA\x00\xDB\x00\xEC\x00\x00\x00\xFA\x13\x13\xFA\x00\x01\xD5\xEF\x12\x13\xEF\xD5\x00\x03\xB1\xCA\xE4\xFF\x10\x13\xFF\xE4\xCA\xB1\x00\x04\x8B\xA6\xC1\xDD\xFB\x0F\x13\xFB\xDD\xC1\xA6\x8B\x00\x04\x65\x81\x9E\xBD\xE0\x0F\x13\xE0\xBD\x9E\x81\x65\x00\x05\x40\x5E\x7F\xA4\xCB\xF4\x0E\x13\xF4\xCB\xA4\x7F\x5E\x40\x00\x05\x20\x42\x69\x93\xBF\xEA\x0E\x13\xEA\xBF\x93\x69\x42\x20\x00\x05\x09\x30\x5C\x89\xB6\xE2\x0E\x13\xE2\xB6\x89\x5C\x30\x09\x01\x05\x25\x53\x80\xAD\xD9\x0E\x12\xD9\xAD\x80\x53\x25\x01\x06\x1C\x49\x76\xA2\xCD\xF8\x0D\x12\xF8\xCD\xA2\x76\x49\x1C\x01\x06\x11\x3D\x69\x95\xC0\xEA\x0D\x12\xEA\xC0\x95\x69\x3D\x11\x02\x07\x2F\x5B\x86\xB0\xD6\xF5\x0C\x11\xF5\xD6\xB0\x86\x5B\x2F\x02\x11\x20\x4A\x74\x9B\xBB\xD2\xE0\xE6\xE6\xE0\xD2\xBB\x9B\x74\x4A\x20\xFF\x02\x11\x0E\x36\x5C\x7E\x99\xAA\xB5\xBA\xBA\xB5\xAA\x99\x7E\x5C\x36\x0E\xFF\x03\x10\x1D\x3F\x5B\x70\x7F\x88\x8D\x8D\x88\x7F\x70\x5B\x3F\x1D\xFF\x03\x10\x00\x1D\x34\x45\x52\x5A\x5F\x5F\x5A\x52\x45\x34\x1D\x00\xFF\x05\x0E\x0B\x1A\x25\x2C\x30\x30\x2C\x25\x1A\x0B\xFF"
    ),
    (
        # ####03262603####
        # ##246B90906B24##
        # 006AB3D9D9B36A00
        # 228ED8FFFFD88E22
        # 228ED8FFFFD88E22
        # 006AB3D9D9B36A00
        # ##246B90906B24##
        # ####03262603####
        8, 8,
        b"\x00\x00\x07\x00\x10\x00\x1B\x00\x26\x00\x31\x00\x3C\x00\x45\x00\x02\x05\x03\x26\x26\x03\xFF\x01\x06\x24\x6B\x90\x90\x6B\x24\xFF\x00\x07\x00\x6A\xB3\xD9\xD9\xB3\x6A\x00\xFF\x00\x07\x22\x8E\xD8\xFF\xFF\xD8\x8E\x22\xFF\x00\x07\x22\x8E\xD8\xFF\xFF\xD8\x8E\x22\xFF\x00\x07\x00\x6A\xB3\xD9\xD9\xB3\x6A\x00\xFF\x01\x06\x24\x6B\x90\x90\x6B\x24\xFF\x02\x05\x03\x26\x26\x03\xFF"
    ),
    (
        # FF------------------------------------FF
        # FF----------------------------------EFE1
        # FF------------------------------F4D9C5B6
        # FF----------------------------FFD8B69D8A
        # FF----------------------------EAC29B7A61
        # FF--------------------------F6D3AE855E3D
        # FF------------------------F1D7B7956E4721
        # FF----------------F8EFE5DACBB49675522E08
        # FF--------F2E8DFD5CCC2B9AFA28E73533211##
        # FFF1E6DCD1C6BCB2A99F958B8176664D3011####
        # D7C6BAAFA4998E847B71675D53493B270D######
        # AE9B8D82776B60564C42392F251B1000########
        # 86706054493D32281E150B##################
        # 5E4634261B1006##########################
        20, 14,
        b"\x00\x00\x06\x00\x0D\x00\x16\x00\x20\x00\x2A\x00\x35\x00\x41\x00\x51\x00\x64\x00\x7A\x00\x8E\x00\xA1\x00\xAF\x00\x00\x00\xFF\x13\x13\xFF\x00\x00\xFF\x12\x13\xEF\xE1\x00\x00\xFF\x10\x13\xF4\xD9\xC5\xB6\x00\x00\xFF\x0F\x13\xFF\xD8\xB6\x9D\x8A\x00\x00\xFF\x0F\x13\xEA\xC2\x9B\x7A\x61\x00\x00\xFF\x0E\x13\xF6\xD3\xAE\x85\x5E\x3D\x00\x00\xFF\x0D\x13\xF1\xD7\xB7\x95\x6E\x47\x21\x00\x00\xFF\x09\x13\xF8\xEF\xE5\xDA\xCB\xB4\x96\x75\x52\x2E\x08\x00\x00\xFF\x05\x12\xF2\xE8\xDF\xD5\xCC\xC2\xB9\xAF\xA2\x8E\x73\x53\x32\x11\x00\x00\xFF\x01\x11\xF1\xE6\xDC\xD1\xC6\xBC\xB2\xA9\x9F\x95\x8B\x81\x76\x66\x4D\x30\x11\x00\x10\xD7\xC6\xBA\xAF\xA4\x99\x8E\x84\x7B\x71\x67\x5D\x53\x49\x3B\x27\x0D\xFF\x00\x0F\xAE\x9B\x8D\x82\x77\x6B\x60\x56\x4C\x42\x39\x2F\x25\x1B\x10\x00\xFF\x00\x0A\x86\x70\x60\x54\x49\x3D\x32\x28\x1E\x15\x0B\xFF\x00\x06\x5E\x46\x34\x26\x1B\x10\x06\xFF"
    ),
    (
        # FF----------------------------------------------------------------------------------------FDF7F6F9
        # FF----------------------------------------------------------------------FEF8F3EDE7E2DCD7D1CCC6C5C9
        # FF--------------------------------FCF9F5F2F2F0EDEAE8E7E4E1DEDEDCD8D5D4D1CDC7C2BCB6B1ABA59F9A949397
        # FFFFFAF7F3EFEBE7E4E0DCD8D5D3D0CDCACAC7C4C1C0BFBCB8B6B6B3AFACACAAA6A3A19F9B958F89837D77726C66616065
        # D7CEC9C5C2BEBAB6B2AFAAA6A3A19D9A979694918D8C8B888481817F7B787776726F6C6B67625C555049443E39322E2D32
        # A79C96928F8A86837E7B76726F6C69666261605D59575754504D4C4B474442413E3B3736332E28221C16110B0600000001
        # 766A635E5B56524F4A46433E3B3735322E2C2C292522221F1C18171613100D0D0B07040300########################
        # 45372F2A26221E1B16130F0B070402####################################################################
        49, 8,
        b"\x00\x00\x09\x00\x1B\x00\x40\x00\x75\x00\xA9\x00\xDD\x00\x05\x01\x00\x00\xFF\x2D\x30\xFD\xF7\xF6\xF9\x00\x00\xFF\x24\x30\xFE\xF8\xF3\xED\xE7\xE2\xDC\xD7\xD1\xCC\xC6\xC5\xC9\x00\x00\xFF\x11\x30\xFC\xF9\xF5\xF2\xF2\xF0\xED\xEA\xE8\xE7\xE4\xE1\xDE\xDE\xDC\xD8\xD5\xD4\xD1\xCD\xC7\xC2\xBC\xB6\xB1\xAB\xA5\x9F\x9A\x94\x93\x97\x00\x00\xFF\x01\x30\xFF\xFA\xF7\xF3\xEF\xEB\xE7\xE4\xE0\xDC\xD8\xD5\xD3\xD0\xCD\xCA\xCA\xC7\xC4\xC1\xC0\xBF\xBC\xB8\xB6\xB6\xB3\xAF\xAC\xAC\xAA\xA6\xA3\xA1\x9F\x9B\x95\x8F\x89\x83\x7D\x77\x72\x6C\x66\x61\x60\x65\x00\x30\xD7\xCE\xC9\xC5\xC2\xBE\xBA\xB6\xB2\xAF\xAA\xA6\xA3\xA1\x9D\x9A\x97\x96\x94\x91\x8D\x8C\x8B\x88\x84\x81\x81\x7F\x7B\x78\x77\x76\x72\x6F\x6C\x6B\x67\x62\x5C\x55\x50\x49\x44\x3E\x39\x32\x2E\x2D\x32\xFF\x00\x30\xA7\x9C\x96\x92\x8F\x8A\x86\x83\x7E\x7B\x76\x72\x6F\x6C\x69\x66\x62\x61\x60\x5D\x59\x57\x57\x54\x50\x4D\x4C\x4B\x47\x44\x42\x41\x3E\x3B\x37\x36\x33\x2E\x28\x22\x1C\x16\x11\x0B\x06\x00\x00\x00\x01\xFF\x00\x24\x76\x6A\x63\x5E\x5B\x56\x52\x4F\x4A\x46\x43\x3E\x3B\x37\x35\x32\x2E\x2C\x2C\x29\x25\x22\x22\x1F\x1C\x18\x17\x16\x13\x10\x0D\x0D\x0B\x07\x04\x03\x00\xFF\x00\x0E\x45\x37\x2F\x2A\x26\x22\x1E\x1B\x16\x13\x0F\x0B\x07\x04\x02\xFF"
    ),
])
def test_shattermap_decompress_compress_roundtrip(cols, rows, compressed_shattermap):
    decompressed_shattermap = shattermaps.decompress_shattermap(compressed_shattermap, cols, rows)
    new_compressed_shattermap = shattermaps.compress_shattermap(decompressed_shattermap)

    # Cannot compare the compressed bytes directly because the original shattermaps have some values that could have
    # been included in the compressed runs (e.g. 00 values at the start or end, or FF in the middle run). This is
    # probably because they did the compression on the original floating-point values so some values didn't not get
    # included in the runs but when quantised to 8-bit numbers they still ended up as 00 or FF.
    # We do the compression after the quantisation, so we don't have this problem but we don't get exactly the same
    # bytes back.
    # assert_array_equal(
    #    np.frombuffer(new_compressed_shattermap, dtype=np.uint8),
    #    np.frombuffer(compressed_shattermap, dtype=np.uint8)
    # )
    # Just do a simple sanity check for the byte lengths, so it doesn't end up wildly different
    assert abs(len(compressed_shattermap) - len(new_compressed_shattermap)) <= 6

    new_decompressed_shattermap = shattermaps.decompress_shattermap(new_compressed_shattermap, cols, rows)
    assert_array_equal(new_decompressed_shattermap, decompressed_shattermap)

    expected_ascii = shattermaps.shattermap_compressed_to_ascii(compressed_shattermap, cols, rows)
    new_ascii = shattermaps.shattermap_to_ascii(new_decompressed_shattermap)
    # Normalize the ascii representations due to the compression differences mentioned before
    expected_ascii = "\n".join(expected_ascii).replace("--", "FF").replace("##", "00")
    new_ascii = "\n".join(new_ascii).replace("--", "FF").replace("##", "00")
    assert new_ascii == expected_ascii
